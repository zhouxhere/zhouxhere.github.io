<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>个人服务器 | 人是要有一点精神的</title><meta name=keywords content><meta name=description content="个人服务器搭建相关记录"><meta name=author content="zhouxhere"><link rel=canonical href=https://zhouxhere.com/post/personal-server/><link crossorigin=anonymous href=/assets/css/stylesheet.min.1e44d58192cbf6d7a4eb649bc43dbc3d4cc432677e5d8adc69b08c34cbe461ac.css integrity="sha256-HkTVgZLL9tek62SbxD28PUzEMmd+XYrcabCMNMvkYaw=" rel="preload stylesheet" as=style><link rel=icon href=https://zhouxhere.com/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zhouxhere.com/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zhouxhere.com/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://zhouxhere.com/favicon/apple_touch_icon.png><link rel=mask-icon href=https://zhouxhere.com/favicon/apple_touch_icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="个人服务器"><meta property="og:description" content="个人服务器搭建相关记录"><meta property="og:type" content="article"><meta property="og:url" content="https://zhouxhere.com/post/personal-server/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-10-26T14:11:51+08:00"><meta property="article:modified_time" content="2022-10-26T14:11:51+08:00"><meta property="og:site_name" content="人是要有一点精神的"><meta name=twitter:card content="summary"><meta name=twitter:title content="个人服务器"><meta name=twitter:description content="个人服务器搭建相关记录"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"hello","item":"https://zhouxhere.com/post/"},{"@type":"ListItem","position":2,"name":"个人服务器","item":"https://zhouxhere.com/post/personal-server/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"个人服务器","name":"个人服务器","description":"个人服务器搭建相关记录","keywords":[],"articleBody":"​\t由于服务器暂时采用的是云服务器，是一个1核2G的服务器，没有搭建较多的东西，后续购买的 nas 到了之后，会迁移部分服务至 nas 中。\n服务器采用的方法 ​\t由于服务器较小，而且搭建的内容仅供个人使用，所以才用了 docker 来进行部署，后续也容易进行备份与迁移；核心使用 docker，采用 portainer 来进行在线管理 docker ，使用 nginxproxymanger 来进行域名配置。\n服务器所部属的内容 服务器相关  portainer docker 管理 nginxproxymanager nginx 代理  ​\t其中比较特殊的 nginxproxymanager 需要将端口映射至服务器上，其他的容器可自行配置 ip 来进行部署，无需映射端口至服务器（一些数据库的端口或者 udp 等特殊端口采用映射更方便），如此一来，容器的服务都可通过 nginxproxymanager 来进行域名配置。\n​\t由于 portainer 也不对外映射端口，所以在部署之时需要先新建 network，并且同时安装了数据库 postgres 以及 mariadb，还有用于在线访问数据库的 adminer，这样以后如需要用到数据库，可以通过 adminer 来进行操作，部署完成完成之后，可通过服务器81访问 nginxproxymanager 来进行二级域名配置，docker-compose 文件如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93  version: '3' services:  portainer:  container_name: portainer  image: portainer/portainer-ce:latest  restart: unless-stopped  environment:  - LANG=C.UTF-8  volumes:  - /etc/timezone:/etc/timezone:ro  - /etc/localtime:/etc/localtime:ro  - /var/run/docker.sock:/var/run/docker.sock  - ./portainer:/data  networks:  internel:  ipv4_address: 172.19.0.6  postgresql:  container_name: postgresql  image: postgres:14-alpine  restart: unless-stopped  environment:  - POSTGRES_USER=postgres  - POSTGRES_PASSWORD=postgres_password  - LANG=C.UTF-8  volumes:  - /etc/timezone:/etc/timezone:ro  - /etc/localtime:/etc/localtime:ro  - ./postgresql:/var/lib/postgresql/data  ports:  - 5432:5432  networks:  internel:  ipv4_address: 172.19.0.7  mariadb:  container_name: mariadb  image: mariadb  restart: unless-stopped  environment:  - MARIADB_ROOT_PASSWORD=root_password  - MARIADB_DATABASE=proxy  - MARIADB_USER=proxy  - MARIADB_PASSWORD=proxy_password  - LANG=C.UTF-8  volumes:  - /etc/timezone:/etc/timezone:ro  - /etc/localtime:/etc/localtime:ro  - ./mariadb:/var/lib/mysql  ports:  - 3306:3306  networks:  internel:  ipv4_address: 172.19.0.8  proxy:  container_name: proxy  image: 'jc21/nginx-proxy-manager:latest'  restart: unless-stopped  environment:  - DB_MYSQL_HOST=172.19.0.8  - DB_MYSQL_PORT=3306  - DB_MYSQL_USER=proxy  - DB_MYSQL_PASSWORD=proxy_password  - DB_MYSQL_NAME=proxy  - LANG=C.UTF-8  ports:  - '80:80'  - '81:81'  - '443:443'  volumes:  - /etc/timezone:/etc/timezone:ro  - /etc/localtime:/etc/localtime:ro  - ./proxy/data:/data  - ./proxy/letsencrypt:/etc/letsencrypt  networks:  internel:  ipv4_address: 172.19.0.9  adminer:  container_name: adminer  image: adminer  restart: unless-stopped  environment:  - LANG=C.UTF-8  volumes:  - /etc/timezone:/etc/timezone:ro  - /etc/localtime:/etc/localtime:ro  networks:  internel:  ipv4_address: 172.19.0.10 networks:  internel:  driver: bridge  ipam:  config:  - subnet: 172.19.0.0/16   开发相关  gitea git服务器，英文文档为最新的 drone 自动打包及部署 frp 内网穿透，采用第三方或者自己手写dockerfile  ​\t在部署之前可以通过之前部署的 adminer 来新建 gitea 和 drone 所需要的数据库，然后在部署时填写上对应的 bridge 配置的 ip 以及数据库名和密码等相关参数，而 drone 则需要在 gitea 部署之后再部署，至于原因可以查看 drone 官方文档，frp 则是为了本地开发时所需要。\n博客相关  hugo + PaperMod（主题） nginx docker walinejs 评论 umami 访问统计 minio 图床  ​\t其中为什么要采用 nginx docker 来部署 而不是直接采用 hugo server 的原因如下\n​\t其次在采用 docker nginx 进行发布是通过挂载 /var/run/docker.sock 至 docker 镜像中，挂载需要在drone中配置项目为 trusted，这样在容器中使用 docker 命令即可控制服务器的 docker，然后可采用 docker cp ./ nginx:/usr/share/nginx/html 来进行发布，具体 .drone.yml 如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  kind: pipeline  steps:  - name: build  image: alpine/git  commands:  - git submodule set-url themes/PaperMod https://github.com/adityatelange/hugo-PaperMod.git  - git submodule init  - git submodule update --recursive --remote  - sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories  - apk update  - apk add hugo  - hugo config check  - hugo   - name: publish  image: docker  volumes:  - name: dockersock  path: /var/run  commands:  - cd public  - sleep 5  - docker cp ./ nginx:/usr/share/nginx/html  volumes:  - name: dockersock  host:  path: /var/run   结语 由于服务器较小，后续肯定要进行修改以及迁移等操作。待更新。。。\n","wordCount":"468","inLanguage":"zh","datePublished":"2022-10-26T14:11:51+08:00","dateModified":"2022-10-26T14:11:51+08:00","author":{"@type":"Person","name":"zhouxhere"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhouxhere.com/post/personal-server/"},"publisher":{"@type":"Organization","name":"人是要有一点精神的","logo":{"@type":"ImageObject","url":"https://zhouxhere.com/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://zhouxhere.com/ accesskey=h title="zhouxhere (Alt + H)">zhouxhere</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://zhouxhere.com/archives/ title=归档><span>归档</span></a></li><li><a href=https://zhouxhere.com/categories/ title=分类><span>分类</span></a></li><li><a href=https://zhouxhere.com/tags/ title=标签><span>标签</span></a></li><li><a href=https://zhouxhere.com/series/ title=系列><span>系列</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>个人服务器</h1><div class=post-meta><span title="2022-10-26 14:11:51 +0800 +0800">2022-10-26</span>&nbsp;·&nbsp;3 分钟&nbsp;·&nbsp;zhouxhere</div></header><div class=post-content><p>​ 由于服务器暂时采用的是云服务器，是一个1核2G的服务器，没有搭建较多的东西，后续购买的 nas 到了之后，会迁移部分服务至 nas 中。</p><h2 id=服务器采用的方法>服务器采用的方法<a hidden class=anchor aria-hidden=true href=#服务器采用的方法>#</a></h2><p>​ 由于服务器较小，而且搭建的内容仅供个人使用，所以才用了 docker 来进行部署，后续也容易进行备份与迁移；核心使用 <a href=https://docs.docker.com/engine/install/>docker</a>，采用 <a href=https://docs.portainer.io/start/install>portainer</a> 来进行在线管理 docker ，使用 <a href=https://nginxproxymanager.com/guide/#quick-setup>nginxproxymanger</a> 来进行域名配置。</p><h2 id=服务器所部属的内容>服务器所部属的内容<a hidden class=anchor aria-hidden=true href=#服务器所部属的内容>#</a></h2><h3 id=服务器相关>服务器相关<a hidden class=anchor aria-hidden=true href=#服务器相关>#</a></h3><ul><li><a href=https://docs.portainer.io/start/install>portainer</a> docker 管理</li><li><a href=https://nginxproxymanager.com/guide/#quick-setup>nginxproxymanager</a> nginx 代理</li></ul><p>​ 其中比较特殊的 nginxproxymanager 需要将端口映射至服务器上，其他的容器可自行配置 ip 来进行部署，无需映射端口至服务器（一些数据库的端口或者 udp 等特殊端口采用映射更方便），如此一来，容器的服务都可通过 nginxproxymanager 来进行域名配置。</p><p>​ 由于 portainer 也不对外映射端口，所以在部署之时需要先新建 network，并且同时安装了数据库 postgres 以及 mariadb，还有用于在线访问数据库的 adminer，这样以后如需要用到数据库，可以通过 adminer 来进行操作，部署完成完成之后，可通过服务器81访问 nginxproxymanager 来进行二级域名配置，docker-compose 文件如下</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">93
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>portainer</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>portainer</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>portainer/portainer-ce:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>LANG=C.UTF-8</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/timezone:/etc/timezone:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/var/run/docker.sock:/var/run/docker.sock</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./portainer:/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>internel</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ipv4_address</span>: <span style=color:#ae81ff>172.19.0.6</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgresql</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>postgresql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:14-alpine</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>POSTGRES_USER=postgres</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>POSTGRES_PASSWORD=postgres_password</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>LANG=C.UTF-8</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/timezone:/etc/timezone:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./postgresql:/var/lib/postgresql/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>5432</span>:<span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>internel</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ipv4_address</span>: <span style=color:#ae81ff>172.19.0.7</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mariadb</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>mariadb</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mariadb</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>MARIADB_ROOT_PASSWORD=root_password</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>MARIADB_DATABASE=proxy</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>MARIADB_USER=proxy</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>MARIADB_PASSWORD=proxy_password</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>LANG=C.UTF-8</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/timezone:/etc/timezone:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./mariadb:/var/lib/mysql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>3306</span>:<span style=color:#ae81ff>3306</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>internel</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ipv4_address</span>: <span style=color:#ae81ff>172.19.0.8</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>proxy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>proxy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#e6db74>&#39;jc21/nginx-proxy-manager:latest&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DB_MYSQL_HOST=172.19.0.8</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DB_MYSQL_PORT=3306</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DB_MYSQL_USER=proxy</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DB_MYSQL_PASSWORD=proxy_password</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DB_MYSQL_NAME=proxy</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>LANG=C.UTF-8</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;80:80&#39;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;81:81&#39;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;443:443&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/timezone:/etc/timezone:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./proxy/data:/data</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./proxy/letsencrypt:/etc/letsencrypt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>internel</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ipv4_address</span>: <span style=color:#ae81ff>172.19.0.9</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>adminer</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>adminer</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>adminer</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>LANG=C.UTF-8</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/timezone:/etc/timezone:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>internel</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ipv4_address</span>: <span style=color:#ae81ff>172.19.0.10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>internel</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>bridge</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ipam</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>subnet</span>: <span style=color:#ae81ff>172.19.0.0</span><span style=color:#ae81ff>/16</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=开发相关>开发相关<a hidden class=anchor aria-hidden=true href=#开发相关>#</a></h3><ul><li><a href=https://docs.gitea.io/en-us/install-with-docker/>gitea</a> git服务器，英文文档为最新的</li><li><a href=https://docs.drone.io/>drone</a> 自动打包及部署</li><li><a href=https://gofrp.org/docs/>frp</a> 内网穿透，采用第三方或者自己手写dockerfile</li></ul><p>​ 在部署之前可以通过之前部署的 adminer 来新建 gitea 和 drone 所需要的数据库，然后在部署时填写上对应的 bridge 配置的 ip 以及数据库名和密码等相关参数，而 drone 则需要在 gitea 部署之后再部署，至于原因可以查看 drone 官方文档，frp 则是为了本地开发时所需要。</p><h3 id=博客相关>博客相关<a hidden class=anchor aria-hidden=true href=#博客相关>#</a></h3><ul><li><a href=https://gohugo.io/documentation/>hugo</a> + <a href=https://github.com/adityatelange/hugo-PaperMod>PaperMod</a>（主题）</li><li><a href=https://hub.docker.com/_/nginx/>nginx</a> docker</li><li><a href=https://waline.js.org/guide/get-started.html>walinejs</a> 评论</li><li><a href=https://umami.is/docs/getting-started>umami</a> 访问统计</li><li><a href=https://min.io/docs/minio/container/index.html>minio</a> 图床</li></ul><p>​ 其中为什么要采用 nginx docker 来部署 而不是直接采用 <code>hugo server</code> 的原因如下</p><p><img loading=lazy src=https://minio-api.zhouxhere.com:443/zhouxhere/2022/10/26/image-20221026152457942_repeat_1666769109410__566849.png alt=image-20221026152457942></p><p>​ 其次在采用 docker nginx 进行发布是通过挂载 <code>/var/run/docker.sock</code> 至 docker 镜像中，挂载需要在drone中配置项目为 trusted，这样在容器中使用 docker 命令即可控制服务器的 docker，然后可采用 <code>docker cp ./ nginx:/usr/share/nginx/html</code> 来进行发布，具体 .drone.yml 如下</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>pipeline</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>alpine/git</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>commands</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>git submodule set-url themes/PaperMod https://github.com/adityatelange/hugo-PaperMod.git</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>git submodule init</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>git submodule update --recursive --remote</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>sed -i &#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&#39; /etc/apk/repositories</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>apk update</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>apk add hugo</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>hugo config check</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>hugo</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>publish</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>docker</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dockersock</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/var/run</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>commands</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>cd public</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>sleep 5</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>docker cp ./ nginx:/usr/share/nginx/html</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dockersock</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>host</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/var/run</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=结语>结语<a hidden class=anchor aria-hidden=true href=#结语>#</a></h2><p>由于服务器较小，后续肯定要进行修改以及迁移等操作。待更新。。。</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://zhouxhere.com/>人是要有一点精神的</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span><br><span><a href=http://beian.miit.gov.cn/ target=_blank rel="nofollow noopener">鄂ICP备2021019839号</a></span>
<span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42098202000081" rel="nofollow noopener" class=beian-police target=_blank><img style=display:inline-block;height:1em src=/images/beian.png alt=police-icon>
<span>鄂公网安备42098202000081号</span></a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="复制";function s(){e.innerText="已复制！",setTimeout(()=>{e.innerText="复制"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>